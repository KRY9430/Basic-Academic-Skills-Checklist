
<!DOCTYPE html>
<html lang="ko">
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
</script>
<meta charset="UTF-8">
<title>수리력 향상 점검 도구</title>
<style>
.tooltip { position: relative; display: inline-block; cursor: help; }
.tooltip .tooltiptext { visibility: hidden; width: 400px; background: #f9f9f9; color: #000; border: 1px solid #ccc; padding: 8px; border-radius: 4px; position: absolute; z-index: 1; top: 100%; left: 0; white-space: pre-line; }
.tooltip:hover .tooltiptext { visibility: visible; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
th { background: #f2f2f2; }
.control-panel { margin: 10px 0; }
th:nth-child(1), td:nth-child(1),
th:nth-child(2), td:nth-child(2) {
  width: 80px;           /* 좁은 너비 */
  white-space: normal;   /* 줄바꿈 허용 */
  word-break: keep-all;  /* 단어 중간에서 줄바꿈 안 함 (띄어쓰기 기준으로만 줄바꿈) */
}
th:nth-child(4), td:nth-child(4) {
  width: 40%;
  min-width: 280px;
  text-align: left;
}
th:nth-child(7), td:nth-child(7) {
  width: 160px;         /* 너비 고정 또는 적당히 좁게 */
  max-width: 180px;
  white-space: nowrap;  /* 줄바꿈 방지 */
}
</style>
</head>
<body>
<h2>수리력 향상 점검 도구</h2>
<div class="control-panel">
학년군:
<label><input type="checkbox" class="gradeFilter" value="1~2" checked> 1~2학년군</label>
<label><input type="checkbox" class="gradeFilter" value="3~4" checked> 3~4학년군</label>
<label><input type="checkbox" class="gradeFilter" value="5~6" checked> 5~6학년군</label>
<button onclick="applyFilter()">적용</button>
<button onclick="resetFilter()">초기화</button>
</div>
<table id="checklistTable">
   <thead>
    <tr>
     <th colspan="1" rowspan="2">
      영역
     </th>
     <th colspan="1" rowspan="2">
      하위 요소
     </th>
     <th colspan="1" rowspan="2">
      학년군
     </th>
     <th colspan="1" rowspan="2">
      점검 항목
     </th>
     <th colspan="2" rowspan="1">
      도달 여부
     </th>
     <th colspan="1" rowspan="2">
      평정 근거
     </th>
     <th colspan="1" rowspan="2">
      보조 자료
     </th>
    </tr>
    <tr>
     <th>
      미도달
     </th>
     <th>
      도달
     </th>
    </tr>
   </thead><tbody id="tableBody">
</tbody>
</table>
<div style="margin-top:10px;">
<button onclick="exportExcel()">엑셀로 저장</button>
</div>
<script>
let previousStates = {};
const data = [
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '1~2',
  '점검 항목': '▪  한 자리 수를 세고 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수를 세고 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '1~2',
  '점검 항목': '▪  세 자리 수를 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '1~2',
  '점검 항목': '▪  네 자리 수를 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '1~2',
  '점검 항목': '▪  네 자리 이하의 수의 범위에서 수의 계열을 이해하고, 수의 크기를 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  만, 억 단위의 수를 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  다섯 자리 이상의 수의 범위에서 수의 계열을 이해하고, 수의 크기를 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  양의 등분할을 통하여 분수를 이해하고 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  단위분수와 진분수의 관계를 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  가분수를 대분수로, 대분수를 가분수로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  분모가 같은 분수끼리 크기를 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  단위분수끼리 크기를 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  분모가 10, 100, 1000인 분수를 소수로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  소수 세 자리 수의 범위에서 소수를 읽고 쓸 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '3~4',
  '점검 항목': '▪  소수의 크기를 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  약수의 의미를 알고 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  공약수, 최대공약수의 의미를 알고 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  배수의 의미를 알고 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  공배수, 최소공배수의 의미를 알고 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  분수의 성질을 이용하여 크기가 같은 분수를 만들 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  분수를 약분할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  분수를 통분할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수 감각',
  '학년군': '5~6',
  '점검 항목': '▪  분모가 다른 분수의 크기를 비교할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 수의 모으기를 할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  하나의 수를 두 수로 가르기를 할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수의 범위에서 받아올림이 없는 덧셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수의 범위에서 받아내림이 없는 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수의 범위에서 받아올림이 있는 덧셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수의 범위에서 받아내림이 있는 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수의 범위에서 덧셈식을 뺄셈식으로 바꿀 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  두 자리 수의 범위에서 뺄셈식을 덧셈식으로 바꿀 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '1~2',
  '점검 항목': '▪  한 자리 수의 곱셈을 할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  세 자리 수의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  (두 자리 수)×(한 자리 수)를 계산할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  (세 자리 수)×(한 자리 수)를 계산할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  (두 자리 수)×(두 자리 수)를 계산할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  곱셈식을 나눗셈식으로 바꿀 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  나눗셈식을 곱셈식으로 바꿀 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  나누어떨어지는 (두 자리 수)÷(한 자리 수)를 계산할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  나누어떨어지지 않는 (두 자리 수)÷(한 자리 수)의 몫과 나머지를 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  분모가 같은 분수의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '3~4',
  '점검 항목': '▪  소수 두 자리 수의 범위에서 소수의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '5~6',
  '점검 항목': '▪  분모가 다른 진분수의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '5~6',
  '점검 항목': '▪  진분수의 곱셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '5~6',
  '점검 항목': '▪  (자연수)÷(자연수)의 몫을 분수로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '5~6',
  '점검 항목': '▪  분수를 소수로, 소수를 분수로 바꾸어 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '5~6',
  '점검 항목': '▪  (소수)×(자연수)를 계산할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '수와 연산',
  '하위 요소': '수의 계산',
  '학년군': '5~6',
  '점검 항목': '▪  (소수)÷(자연수)를 계산할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '변화와 함수',
  '학년군': '1~2',
  '점검 항목': '▪  물체, 무늬, 수 등의 배열에서 규칙을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '변화와 함수',
  '학년군': '3~4',
  '점검 항목': '▪  간단한 배열에서 규칙을 수나 식으로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '변화와 함수',
  '학년군': '5~6',
  '점검 항목': '▪  대응 관계를 나타낸 표에서 규칙을 찾아 표의 빈칸을 채울 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '변화와 함수',
  '학년군': '5~6',
  '점검 항목': '▪  대응 관계를 나타낸 표에서 규칙을 찾아 □, △ 등을 사용하여 식으로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '비와 비율',
  '학년군': '5~6',
  '점검 항목': '▪  두 양의 크기를 비교하여 그 관계를 비로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '비와 비율',
  '학년군': '5~6',
  '점검 항목': '▪  비율을 분수, 소수, 백분율로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '비와 비율',
  '학년군': '5~6',
  '점검 항목': '▪  간단한 비례식을 풀 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '변화와 관계',
  '하위 요소': '비와 비율',
  '학년군': '5~6',
  '점검 항목': '▪  주어진 양을 비례배분할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '1~2',
  '점검 항목': '▪  생활 주변에서 직육면체, 원기둥, 구의 모양을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '1~2',
  '점검 항목': '▪  한 기준에 대해 오른쪽, 왼쪽, 앞, 뒤, 위, 아래의 방향을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  직육면체와 정육면체를 알고, 그 성질을 이해한다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  직육면체와 정육면체의 겨냥도를 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  직육면체와 정육면체의 전개도를 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  각기둥을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  각뿔을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  각기둥의 전개도를 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  원기둥을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  원기둥의 전개도를 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  원뿔을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  구를 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  쌓기나무로 만든 입체도형을 보고 사용된 쌓기나무의 개수를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '입체도형의 성질',
  '학년군': '5~6',
  '점검 항목': '▪  쌓기나무로 만든 입체도형의 위, 앞, 옆에서 본 모양을 표현할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '1~2',
  '점검 항목': '▪  생활 주변에서 삼각형, 사각형, 원의 모양을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '1~2',
  '점검 항목': '▪  삼각형, 사각형, 원을 직관적으로 이해하고, 그 모양을 그릴 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '1~2',
  '점검 항목': '▪  오각형, 육각형을 알고 구별할 수 있다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  각을 알고, 직각을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  예각과 둔각을 구별할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  원의 중심, 반지름, 지름을 알고, 그 관계를 이해한다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  이등변삼각형을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  정삼각형을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  직각삼각형, 예각삼각형, 둔각삼각형을 알고, 구별할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  직사각형을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  정사각형을 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  사다리꼴, 평행사변형, 마름모를 알고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형의 성질',
  '학년군': '3~4',
  '점검 항목': '▪  다각형과 정다각형의 의미를 안다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '3~4',
  '점검 항목': '▪  직선의 수직관계와 평행관계를 이해한다. ',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '3~4',
  '점검 항목': '▪  주어진 도형을 밀기 한 것을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '3~4',
  '점검 항목': '▪  주어진 도형을 뒤집기 한 것을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '3~4',
  '점검 항목': '▪  주어진 도형을 돌리기 한 것을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '5~6',
  '점검 항목': '▪  도형의 합동의 의미를 알고, 합동인 도형을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '5~6',
  '점검 항목': '▪  합동인 두 도형에서 대응점, 대응변, 대응각을 각각 찾고, 그 성질을 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '평면도형 사이의 관계',
  '학년군': '5~6',
  '점검 항목': '▪  선대칭도형을 찾을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': '▪  구체물의 길이, 들이, 무게, 넓이를 각각 직관적으로 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': "▪  시계를 보고 시각을 읽을 수 있다.('몇 시 몇 분'까지)",
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': "▪  1시간은 60분임을 알고, 시간을 '시간', '분'으로 표현할 수 있다.",
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': '▪  1분, 1시간, 1일, 1주일, 1개월, 1년 사이의 관계를 이해한다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': '▪  1cm, 1m의 단위를 알고, 이를 이용하여 길이를 측정하고 어림할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': '▪  1m가 100cm임을 알고, 길이를 cm와 m를 사용하여 표현할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '1~2',
  '점검 항목': '▪  실생활에서 길이의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1분은 60초임을 알고, 초 단위까지 시각을 읽을 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  시와 분 단위에서 시간의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1mm와 1km의 단위를 알고, 길이의 측정값을 읽고 어림할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1cm는 10mm임을 알고, 길이를 cm와 mm를 사용하여 표현할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1km는 1000m임을 알고, 길이를 km와 m를 사용하여 표현할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1L와 1mL의 단위를 알고, 들이의 측정값을 읽고 어림할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1L가 1000mL임을 알고, 들이를 L와 mL를 사용하여 표현할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  실생활에서 들이의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1g와 1kg의 단위를 알고, 이를 이용하여 무게를 측정하고 어림할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1kg이 1000g임을 알고, 무게를 kg과 g을 사용하여 표현할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  실생활에서 무게의 덧셈과 뺄셈을 할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '3~4',
  '점검 항목': '▪  1도(°)를 알고, 이를 이용하여 각의 크기를 측정하고 어림할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '5~6',
  '점검 항목': '▪  이상, 이하, 초과, 미만의 의미를 알고, 이를 활용하여 수의 범위를 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '양의 측정과 어림',
  '학년군': '5~6',
  '점검 항목': '▪  올림, 버림, 반올림의 의미를 알고, 이를 활용하여 어림값을 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  삼각형과 사각형의 둘레의 길이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  1cm², 1m², 1km²의 단위를 알고, 이를 이용하여 넓이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  직사각형의 넓이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  삼각형의 넓이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  평행사변형, 사다리꼴, 마름모의 넓이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  원주율을 알고, 원주를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  원의 넓이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  직육면체와 정육면체의 겉넓이를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  1cm³, 1m³의 단위를 알고, 이를 이용하여 부피를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '도형과 측정',
  '하위 요소': '도형의 측정',
  '학년군': '5~6',
  '점검 항목': '▪  직육면체와 정육면체의 부피를 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '1~2',
  '점검 항목': '▪  생활 주변에 있는 사물들을 정해진 기준으로 분류할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '1~2',
  '점검 항목': '▪  주어진 자료를 표로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '1~2',
  '점검 항목': '▪  주어진 자료를 ○, ×, ／ 등을 이용하여 그래프로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '3~4',
  '점검 항목': '▪  주어진 자료를 막대그래프로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '3~4',
  '점검 항목': '▪  주어진 자료를 꺾은선그래프로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '5~6',
  '점검 항목': '▪  주어진 자료를 그림그래프로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 수집과 정리',
  '학년군': '5~6',
  '점검 항목': '▪  주어진 자료를 띠그래프와 원그래프로 나타낼 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 분석과 해석',
  '학년군': '3~4',
  '점검 항목': '▪  주어진 그래프(막대그래프, 꺾은선그래프)를 보고 해석할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 분석과 해석',
  '학년군': '5~6',
  '점검 항목': '▪  주어진 자료의 평균을 구할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '자료의 분석과 해석',
  '학년군': '5~6',
  '점검 항목': '▪  주어진 그래프(원그래프, 띠그래프, 그림그래프)를 보고 해석할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '경우의 수와 가능성',
  '학년군': '5~6',
  '점검 항목': "▪  실생활에서 가능성과 관련된 상황을 '불가능하다', '~아닐 것 같다', '반반이다', '~일 것 같다', '확실하다' 등으로 나타낼 수 있다.",
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
 {'영역': '자료와 가능성',
  '하위 요소': '경우의 수와 가능성',
  '학년군': '5~6',
  '점검 항목': '▪  가능성을 비교할 수 있다.',
  '세부 점검 요소': '점검 항목별 세부 점검 요소가 표시될 예정입니다.'},
];

function generateTable() {
    const tbody = document.getElementById('tableBody');
    const checkedGrades = Array.from(document.querySelectorAll('.gradeFilter:checked')).map(cb => cb.value);

    // Save previous states using key -> {selectedValue, reason}
    
    document.querySelectorAll("#tableBody tr").forEach(row => {
        const tds = row.querySelectorAll("td");
        if (tds.length < 4) return;
        const key = tds[0].innerText.trim() + "|" + tds[1].innerText.trim() + "|" + tds[2].innerText.trim() + "|" + tds[3].innerText.trim();
        let selectedValue = "";
        row.querySelectorAll("input[type='radio']").forEach(input => {
            if (input.checked) selectedValue = input.value;
        });
        const reasonInput = row.querySelector("input[type='text']");
        const reason = reasonInput ? reasonInput.value.trim() : "";
        previousStates[key] = { selectedValue, reason };
    });

    tbody.innerHTML = "";
    const filtered = data.filter(item => checkedGrades.includes(item['학년군']));
    filtered.forEach((item, idx) => {
        const tr = document.createElement('tr');
        const key = item['영역'] + "|" + item['하위 요소'] + "|" + item['학년군'] + "|" + item['점검 항목'];
        tr.innerHTML = `
<td>${item['영역']}</td>
<td>${item['하위 요소']}</td>
<td>${item['학년군']}</td>
<td style="text-align:left;">
  <div class="tooltip">
    ${item['점검 항목']}
    <span class="tooltiptext">${item['세부 점검 요소']}</span>
  </div>
</td>
<td><input type="radio" name="radio_${idx}" value="미도달"></td>
<td><input type="radio" name="radio_${idx}" value="도달"></td>
<td>
<div style="display: flex; align-items: center; gap: 4px; max-width: 230px;">
  <select style="flex: 0 0 60px; min-width: 50px;">
      <option value="">선택</option>
      <option value="① 이전 검사 결과 분석">① 이전 검사 결과 분석</option>
      <option value="② 신규 검사 시행">② 신규 검사 시행</option>
      <option value="③ 수행 과제 시행 및 관찰">③ 수행 과제 시행 및 관찰</option>
      <option value="④ 수업 중 관찰">④ 수업 중 관찰</option>
      <option value="⑤ 생활지도 중 관찰">⑤ 생활지도 중 관찰</option>
      <option value="⑥ 기타">⑥ 기타</option>
    </select>
    <input type="text" style="flex: 1 1 auto; min-width: 0;">
  </div>
</td>
<td><button onclick="downloadResource()">&#x2B07;</button></td>
`;
        tbody.appendChild(tr);

    });
    const rows = Array.from(document.querySelectorAll('#checklistTable tbody tr'));
    const visible = rows.map(row => row.style.display !== 'none');

    // Helper to get cell text
    function cellText(row, idx) {
        return row.children[idx].innerText.trim();
    }

    // mergeColumn 함수 정의
    function mergeColumn(colIdx, sameGroup) {
        let lastVisibleRow = null;
        let span = 1;

        rows.forEach((row, i) => {
            const currentCell = row.children[colIdx];
            currentCell.rowSpan = 1;
            currentCell.style.display = "";

            if (!lastVisibleRow) {
                lastVisibleRow = row;
                span = 1;
                return;
            }

            if (cellText(row, colIdx) === cellText(lastVisibleRow, colIdx) && sameGroup(row, i, lastVisibleRow)) {
                span++;
                currentCell.style.display = "none";
                lastVisibleRow.children[colIdx].rowSpan = span;
            } else {
                lastVisibleRow = row;
                span = 1;
            }
        });
    }

    // 영역(col0) 병합
    mergeColumn(0, ()=>true);
    // 하위요소(col1) 병합 – 같은 영역 내에서만
    mergeColumn(1, (row,i,lastRow)=> cellText(row,0)===cellText(lastRow,0));
    // 학년(col2) 병합 – 같은 영역·하위요소 내에서만
    mergeColumn(2, (row,i,lastRow)=> cellText(row,0)===cellText(lastRow,0) && cellText(row,1)===cellText(lastRow,1));

}

function resetFilter() {
    location.reload(); // 페이지를 새로고침하여 병합된 셀 구조 유지 및 입력값 완전 초기화
}

document.addEventListener('DOMContentLoaded', generateTable);

function downloadResource() {
    alert('점검 항목에 대한 보조자료가 다운로드 되도록 할 예정입니다.');
}


function exportExcel() {
    const wb = XLSX.utils.book_new();
    const ws_data = [["영역","하위 요소","학년군","점검 항목","미도달","도달","평정 근거"]];

    const rows = document.querySelectorAll("#tableBody tr");
    let currentArea = "";
    let currentGrade = "";

    rows.forEach(row => {
        if (row.style.display === "none") return;

        const tds = row.querySelectorAll("td");
        if (tds.length < 8) return;

        const areaText = tds[0].innerText.trim();
        if (areaText !== "") currentArea = areaText;

        const coreText = tds[1].innerText.trim();
        if (coreText !== "") currentCore = coreText;

        const gradeText = tds[2].innerText.trim();
        if (gradeText !== "") currentGrade = gradeText;

        const content = tds[3].innerText.trim();

        const levelIndicators = [];
        for (let i = 4; i <= 5; i++) {
            const input = tds[i].querySelector("input[type='radio']");
            levelIndicators.push(input && input.checked ? "V" : "");
        }

        const select = tds[6].querySelector("select");
        const reasonInput = tds[6].querySelector("input[type='text']");
        const reason = (select ? select.value : "") + " " + (reasonInput ? reasonInput.value.trim() : "");

        ws_data.push([
            currentArea,
            currentCore,
            currentGrade,
            content,
            ...levelIndicators,
            reason
        ]);
    });

    const ws = XLSX.utils.aoa_to_sheet(ws_data);
    XLSX.utils.book_append_sheet(wb, ws, "수리력 향상 점검 도구");
    XLSX.writeFile(wb, "수리력_향상_점검_결과.xlsx");
}

</script>


<script>
// Enhancement for preserving radio/text inputs when applying filter

function saveCurrentState() {
    const states = {};
    document.querySelectorAll('#checklistTable tbody tr').forEach((row, index) => {
        const radios = row.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
            if (radio.checked) {
                states[`radio_${index}`] = radio.value;
            }
        });
        const select = row.querySelector('select');
        if (select) {
            states[`select_${index}`] = select.value;
        }
    });
    return states;
}

function restoreState(states) {
    document.querySelectorAll('#checklistTable tbody tr').forEach((row, index) => {
        const radios = row.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
            if (states[`radio_${index}`] && radio.value === states[`radio_${index}`]) {
                radio.checked = true;
            }
        });
        const select = row.querySelector('select');
        if (select && states[`select_${index}`] !== undefined) {
            select.value = states[`select_${index}`];
        }
    });
}

function applyFilter() {
    const previousStates = saveCurrentState();

    const selectedGrades = Array.from(document.querySelectorAll('.gradeFilter:checked')).map(cb => cb.value);

    const rows = Array.from(document.querySelectorAll('#checklistTable tbody tr'));

    // 필터 적용
    rows.forEach(row => {
        const grade = row.children[2].textContent.trim();
        if (selectedGrades.includes(grade)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });

    restoreState(previousStates);

    // 병합 전 초기화
    rows.forEach(row => {
        for (let cell of row.cells) {
            cell.rowSpan = 1;
            cell.style.display = "";
        }
    });

    // Helper
    function cellText(row, idx) {
        return row.children[idx].innerText.trim();
    }

    const visible = rows.map(row => row.style.display !== 'none');

    // 병합 함수
    function mergeColumn(colIdx, sameGroup) {
        let lastVisibleRow = null;
        let span = 1;

        rows.forEach((row, i) => {
            if (!visible[i]) return;

            const currentCell = row.children[colIdx];
            if (!lastVisibleRow) {
                lastVisibleRow = row;
                span = 1;
                return;
            }

            if (cellText(row, colIdx) === cellText(lastVisibleRow, colIdx) && sameGroup(row, i, lastVisibleRow)) {
                span++;
                currentCell.style.display = "none";
                lastVisibleRow.children[colIdx].rowSpan = span;
            } else {
                lastVisibleRow = row;
                span = 1;
            }
        });
    }

    // 영역(col0) 병합
    mergeColumn(0, ()=>true);
    // 하위요소(col1) 병합 – 같은 영역 내에서만
    mergeColumn(1, (row,i,lastRow)=> cellText(row,0)===cellText(lastRow,0));
    // 학년(col2) 병합 – 같은 영역·하위요소 내에서만
    mergeColumn(2, (row,i,lastRow)=> cellText(row,0)===cellText(lastRow,0) && cellText(row,1)===cellText(lastRow,1));

}
</script>

</body>

</html>
